{% extends "base.html" %}

{% block title %}Setup Checklist{% endblock %}

{% block content %}
  <div class="row">
    <div class="col-lg-8">
      <h1 class="h3 mb-3">Setup checklist</h1>
      <p class="text-muted">
        Use this page to validate required environment variables before creating
        the first administrator account.
      </p>

      <div class="card mb-4">
        <div class="card-header">Environment health check</div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-sm align-middle">
              <thead>
                <tr>
                  <th scope="col">Variable</th>
                  <th scope="col">Status</th>
                </tr>
              </thead>
              <tbody>
                {% for check in checks %}
                  <tr>
                    <td>{{ check.label }}</td>
                    <td>
                      {% if check.configured %}
                        <span class="badge text-bg-success">Configured</span>
                      {% else %}
                        <span class="badge text-bg-warning">Missing</span>
                      {% endif %}
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>

          {% if missing %}
            <div class="alert alert-info mt-3" role="alert">
              <h2 class="h6">Missing variable guidance</h2>
              <ul class="mb-0">
                {% for check in missing %}
                  <li>{{ check.instruction }}</li>
                {% endfor %}
              </ul>
            </div>
          {% else %}
            <div class="alert alert-success mt-3" role="alert">
              All required environment variables are configured.
            </div>
          {% endif %}
        </div>
      </div>

      <div class="card mb-4">
        <div class="card-header">Configure required settings</div>
        <div class="card-body">
          <p class="text-muted">
            Save these values to the application database during initial setup.
            Stored overrides apply immediately and can be adjusted later in the
            admin settings page. Database connection changes require an app
            restart to take effect.
          </p>
          <form method="post" action="{{ url_for('setup.setup_status') }}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
            {% for field in override_fields %}
              <div class="mb-3">
                <label class="form-label" for="{{ field.name }}">{{ field.label }}</label>
                <input
                  class="form-control"
                  type="{{ field.input_type }}"
                  id="{{ field.name }}"
                  name="{{ field.name }}"
                  value="{{ field.value }}"
                />
                <div class="form-text">{{ field.help_text }}</div>
                {% if field.configured %}
                  <div class="form-text text-success">Currently configured.</div>
                {% endif %}
              </div>
            {% endfor %}
            <button type="submit" class="btn btn-outline-primary">
              Save configuration
            </button>
          </form>
        </div>
      </div>
    </div>
    <div class="col-lg-4">
      <div class="card mb-3">
        <div class="card-header">Next steps</div>
        <div class="card-body d-grid gap-2">
          <a class="btn btn-outline-primary" href="{{ url_for('setup.setup_db_init') }}">
            Initialize database schema
          </a>
          <a class="btn btn-primary" href="{{ url_for('setup.setup_admin') }}">
            Create super admin
          </a>
        </div>
      </div>
    </div>
  </div>
{% endblock %}
